<script>
    $(function()    {
        $('.lessons').sortable({
            update: function( event, ui )   {
                $.ajax({
                    type: 'PUT',
                    url: ui.item.data('update-url'),
                    dataType: 'json',
                    data: { lesson: { row_order_position: ui.item.index() } }
                });
            }
        });

        $('.courses').sortable({
            update: function( event, ui )   {
                $.ajax({
                    type: 'PUT',
                    url: ui.item.data('update-url'),
                    dataType: 'json',
                    data: { section: { row_order_position: ui.item.index() } }
                });
            }
        });
    });

</script>

<br />
<div class="booyah-box col-10 offset-1">
    <h1 class="text-center"><%= current_course.title %></h1>
    <br />
    <%= link_to 'Preview As Student', course_path(current_course), class: 'btn btn-warning float-right' %>
    <br class="clear">
    <br />
    <%= image_tag current_course.image.url, class: 'img-fluid center' %>

    <div class="text-center">
        <%= link_to 'Add a new section', new_instructor_course_section_path(current_course), class: 'btn btn-pimary btn-lg' %>
    </div>

    <ul class="courses">
        <% current_course.sections.rank(:row_order).each do |section| %>
            <li data-update-url=<%= instructor_section_path(section) %>>
                <%= section.title %>
                <%= link_to 'New Lesson', new_instructor_section_lesson_path(section), class: 'float-right bt btn-primary btn-sm' %>
                <ul class="lessons">
                    <% section.lessons.rank(:row_order).each do |lesson| %>
                        <li data-update-url="<%= instructor_lesson_path(lesson) %>"">
                            <b><%= lesson.title %></b>
                            -
                            <%= lesson.subtitle %>
                        </li>
                    <% end %>
                </ul>
                <br class="clear" />
            </li>
        <% end %>
    </ul>

</div>
